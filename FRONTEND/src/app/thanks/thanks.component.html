<section class="thanks container">
  <header class="head">
    <h2>¡Gracias por tu compra!</h2>
    <p class="sub">Tu recibo está listo. Sigue estos pasos para completarlo.</p>
  </header>

  <article class="card">
    <div class="section">
      <!-- Info recibo -->
      <div class="info">
        <p class="muted" *ngIf="receiptUrl(); else missing">
          Recibo: <a [href]="receiptUrl()!" target="_blank" rel="noopener">abrir PDF</a>
        </p>
        <ng-template #missing>
          <p class="warn">No se ha encontrado el recibo en esta sesión.</p>
        </ng-template>
      </div>

      <!-- Pasos -->
      <ol class="steps">
        <!-- PASO 1 -->
        <li class="step">
          <h4>Paso 1 · Abre, revisa tu recibo y descargalo.</h4>
          <p>Comprueba tus datos, artículos y total. Si ves algo incorrecto, vuelve atrás y edítalo. Si todo es correcto, descargalo y usalo en el Paso 3.</p>
          <div class="actions">
            <button class="apply" (click)="openPdf()" [disabled]="!receiptUrl()">
              Abrir recibo (PDF)
            </button>
          </div>
        </li>

        <!-- PASO 2 -->
        <li class="step">
          <h4>Paso 2 · Recíbelo por email</h4>
          <p>Te lo enviamos con el PDF adjunto a tu correo para que lo tengas guardado.</p>
          <div class="actions">
            <button class="clear"
                    (click)="sendEmailBuyer()"
                    [disabled]="!oid() || sendingBuyer()">
              <span *ngIf="!sendingBuyer()">Enviar a mi email</span>
              <span *ngIf="sendingBuyer()">Enviando…</span>
            </button>
          </div>
        </li>

        <!-- PASO 3 -->
        <li class="step">
          <h4>Paso 3 · Notifica al vendedor, Confirma y paga por WhatsApp</h4>
          <p>Envía mensaje de notificación por email (con el recibo en PDF adjunto) para preparar tu pedido.</p>
          <p>Luego envía WhatsApp con el mensaje prellenado para confirmar el pedido y realizar el pago por Bizum. 
            Adjunta el recibo descargado en el Paso 1 y envia el mensaje.
          </p>
          <div class="actions">
            <button class="ghost"
                    (click)="notifyVendorEmail()"
                    [disabled]="!oid() || sendingVendor()">
              <span *ngIf="!sendingVendor()">Notificar por email al vendedor</span>
              <span *ngIf="sendingVendor()">Enviando…</span>
            </button>
            <!-- Enlace “botón” (recomendado) -->
            <a *ngIf="waHref()" class="apply" [href]="waHref()!" target="_blank" rel="noopener">
              Abrir WhatsApp para pagar
            </a>
          </div>
        </li>
      </ol>

      <!-- Volver -->
      <div class="more">
        <button class="ghost" (click)="backToShop()">← Volver a la tienda</button>
      </div>
    </div>
  </article>
</section>
