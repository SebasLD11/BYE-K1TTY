<!-- TOP NAV -->
<header class="topnav">
  <div class="container nav-bar">
    <div class="brand">
      <img class="logo-img" src="assets/img/Logo.BK.png" alt="Bye K1tty" />
      <span class="brand-text">BYE K1TTY</span>
    </div>

    <div class="actions">
      <button type="button" [class.active]="tab()==='shop'" (click)="tab.set('shop')">Shop</button>
      <button type="button" [class.active]="tab()==='about'" (click)="tab.set('about')">About</button>

      <button
        type="button"
        class="theme"
        (click)="toggleTheme()"
        [attr.aria-pressed]="dark"
        [title]="dark ? 'Cambiar a claro' : 'Cambiar a oscuro'">
        {{ dark ? '‚òÄÔ∏è' : 'üåô' }}
      </button>

      <!-- Cart toggle accesible -->
      <button
        type="button"
        class="cart"
        (click)="cartOpen=true"
        aria-label="Abrir carrito"
        aria-controls="drawerCart"
        [attr.aria-expanded]="cartOpen ? 'true' : 'false'">
        Carrito
        <span class="badge" *ngIf="(cartSvc.items$|async)?.length">
          {{ (cartSvc.items$|async)?.length }}
        </span>
      </button>
    </div>
  </div>
</header>

<main class="container">
  <!-- SHOP -->
  <section *ngIf="tab()==='shop'" class="shop">
    <div class="hero">
      <h1>Bienvenido/a a BYE K1TTY</h1>
      <p>
        Aqu√≠ encontrar√°s al detalle cada pieza exclusiva y colecciones que se lanzan. Espero que disfrutes de la
        experiencia y el paso por la tienda. Encontrar√°s dise√±os √∫nicos que no ver√°s en otro lugar, adem√°s de encontrar tu favorito
        y si tienes preguntas, no dudes en contactar.
      </p>
    </div>
    <div class="shop-header">
      <h2>Tienda</h2>
      <div class="right-actions">
        <div class="tags">
          <span *ngFor="let t of allTags()">#{{ t }}</span>
        </div>
        <!-- + aria-controls / expanded -->
        <button type="button" class="filters-toggle" (click)="filtersOpen = true" aria-controls="filtersPanel" [attr.aria-expanded]="filtersOpen ? 'true' : 'false'">
          Filtros
        </button>
      </div>
    </div>

    <div class="shop-layout">
      <!-- backdrop m√≥vil -->
      <div class="filters-backdrop" *ngIf="filtersOpen" (click)="filtersOpen=false"></div>
      <!-- ASIDE: Filtros -->
      <aside id="filtersPanel" class="filters" [class.open]="filtersOpen">
        <header class="filters-head">
          <h3>Filtros</h3>
          <button type="button" class="filters-close" (click)="filtersOpen=false" aria-label="Cerrar filtros">‚úï</button>
        </header>

        <div class="filters-group">
          <label for="searchBox">Buscar</label>
          <input
            id="searchBox"
            type="search"
            placeholder="Nombre del producto‚Ä¶"
            [value]="search()"
            (input)="search.set($any($event.target).value)" />
        </div> 

        <div class="filters-group">
          <label>Etiquetas</label>
          <div class="chips">
            <button
              *ngFor="let t of allTags()"
              class="chip"
              [class.active]="tagChecked(t)"
              (click)="toggleTag(t)">
              {{ t }}
            </button>
          </div>
        </div>

        <div class="filters-group">
          <label>Precio</label>
          <div class="price-row">
            <input
              type="number"
              [min]="priceMin()" [max]="priceMax()"
              [value]="filterMin()"
              (input)="filterMin.set(+($any($event.target).value) || priceMin())">
              <span>‚Äî</span>
            <input
              type="number"
              [min]="priceMin()" [max]="priceMax()"
              [value]="filterMax()"
              (input)="filterMax.set(+($any($event.target).value) || priceMax())">
          </div>
          <small class="muted">
            {{ priceMin() | currency:'EUR' }} ‚Äì {{ priceMax() | currency:'EUR' }}
          </small>
        </div>

        <div class="filters-actions">
          <button class="clear" (click)="clearFilters()">Limpiar</button>
          <button class="apply" (click)="filtersOpen=false">Aplicar</button>
        </div>
      </aside>
      <!-- CAT√ÅLOGO centrado -->
      <section class="catalog">
        <div class="grid">
          <article class="card" *ngFor="let p of filteredProducts()">
            <div class="media" (click)="openProduct(p)">
              <img
                [src]="p.images?.length ? p.images[0] : FALLBACK_IMG"
                [alt]="p.name"
                (error)="onImgErr($event)" />
              <div class="thumbs">
                <img
                  *ngFor="let src of p.images"
                  [src]="src"
                  alt="thumb"
                  (error)="onImgErr($event)" />
              </div>
            </div>
            <div class="info">
              <div>
                <h3>{{ p.name }}</h3>
                <p class="price">{{ p.price | currency:'EUR' }}</p>
              </div>
              <div class="right">
                <span class="tag">{{ p.tag }}</span>
                <button class="add" (click)="cartSvc.add(p)">+ A√±adir</button>
              </div>
            </div>
          </article>
        </div>
      </section>
    </div>
  </section>
  
  <!-- ABOUT -->
  <section *ngIf="tab()==='about'" class="about">
     <div class="about-grid">
    <div class="about-text">
      <h2>Sobre Bye K1tty</h2>
      <p>
        Dise√±ador de moda urbana y artista gr√°fico, especializado en la creaci√≥n de prendas con mensaje provocador y est√©tica underground.
        Mi trabajo fusiona el arte, la cr√≠tica social y la cultura callejera para dar vida a dise√±os √∫nicos que invitan a la reflexi√≥n
        y la autoexpresi√≥n. Colaboro con la comunidad VALODI en el desarrollo de colecciones exclusivas, aportando visi√≥n creativa
        y compromiso por mantener viva la autenticidad de la moda urbana.
      </p>
    </div>

    <figure class="about-media">
      <!-- Cambia el nombre del archivo si es distinto -->
      <img src="assets/img/BK.Vulgar.png" alt="Retrato / trabajo Bye K1tty" loading="lazy" (error)="onImgErr($event)" />
    </figure>
  </div>
</main>

<!-- MODAL PRODUCTO -->
<div class="modal-backdrop" *ngIf="selected" (click)="selected=null"></div>
<div class="modal" *ngIf="selected">
  <div class="modal-body" (click)="$event.stopPropagation()">
    <!-- ‚úï Cerrar modal -->
    <button id="modalClose" class="close-btn" (click)="closeProduct()" aria-label="Cerrar">‚úï</button>

    <div class="viewer">
      <button class="nav prev" (click)="prev()">‚Äπ</button>
      <img
        [src]="selected?.images?.length ? selected?.images[imgIndex] : FALLBACK_IMG"
        [alt]="selected?.name || 'Producto'"
        (error)="onImgErr($event)" />
      <button class="nav next" (click)="next()">‚Ä∫</button>
    </div>

    <div class="thumbs-lg">
      <button
        *ngFor="let src of (selected?.images || []); let i = index"
        [class.active]="i===imgIndex"
        (click)="imgIndex=i">
        <img [src]="src" [alt]="'thumb-'+i" (error)="onImgErr($event)" />
      </button>
    </div>

    <div class="meta">
      <h3>{{ selected?.name }}</h3>
      <div class="row">
        <span class="price">{{ (selected?.price || 0) | currency:'EUR' }}</span>
        <button class="cta" (click)="addFromModal()">A√±adir al carrito</button>
      </div>
    </div>
  </div>
</div>

<!-- DRAWER CARRITO -->
<div id="drawerCart" class="drawer" [class.open]="cartOpen" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
  <header>
    <h3 id="cartTitle">Tu carrito</h3>
    <button id="cartClose" type="button" (click)="cartOpen=false" aria-label="Cerrar carrito">‚úï</button>
  </header>

  <div class="content">
    <div class="item" *ngFor="let it of (cartSvc.items$|async)">
      <img [src]="it.img || FALLBACK_IMG" alt="thumb" (error)="onImgErr($event)" />
      <div class="details">
        <p class="name">{{ it.name }}</p>
        <p class="muted">{{ it.price | currency:'EUR' }}</p>
        <div class="qty">
          <button (click)="cartSvc.dec(it.id)">-</button>
          <span>{{ it.qty }}</span>
          <button (click)="cartSvc.inc(it.id)">+</button>
          <button class="muted" (click)="cartSvc.remove(it.id)">Eliminar</button>
        </div>
      </div>
    </div>
    <p class="empty" *ngIf="!(cartSvc.items$|async)?.length">A√∫n no a√±adiste productos.</p>
  </div>

  <footer>
    <div class="row">
      <span>Total</span>
      <strong>{{ cartSvc.total() | currency:'EUR' }}</strong>
    </div>
    <div class="row gap">
      <button (click)="cartSvc.clear()">Vaciar</button>
      <button [disabled]="!(cartSvc.items$|async)?.length" class="cta" (click)="checkoutNow()">Checkout</button>
    </div>
  </footer>
</div>
