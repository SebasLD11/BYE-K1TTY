<!-- NAV -->
<nav class="nav">
  <div class="brand">
    <div class="logo">BK</div>
    <span>Bye K1tty</span>
  </div>
  <div class="actions">
    <button [class.active]="tab()==='home'" (click)="tab.set('home')">Home</button>
    <button [class.active]="tab()==='shop'" (click)="tab.set('shop')">Shop</button>
    <button [class.active]="tab()==='about'" (click)="tab.set('about')">About</button>
    <button class="theme" (click)="toggleTheme()">Tema</button>
    <button class="cart" (click)="cartOpen=true">
      Carrito
      <span class="badge" *ngIf="(cartSvc.items$|async)?.length">
        {{ (cartSvc.items$|async)?.length }}
      </span>
    </button>
  </div>
</nav>

<main>
  <!-- HOME -->
  <section *ngIf="tab()==='home'" class="hero">
    <div>
      <h1>Bienvenido/a a BYE K1TTY</h1>
      <p>Aquí encontrarás al detalle cada pieza exclusiva y colecciones que se lanzan. Espero que disfrutes de la experiencia y el paso por la tienda. Encontrarás diseños que te volarán la 
        cabeza además de encontrar tu favorito y si tienes preguntas, no dudes en contactar. También podrás suscribirte a la newsletter para ser el primero en conocer las novedades.
      </p>
      <button class="cta" (click)="tab.set('shop')">Ver tienda</button>
    </div>
  </section>

  <!-- SHOP -->
  <section *ngIf="tab()==='shop'">
    <div class="shop-header">
      <h2>Tienda</h2>
      <div class="tags">
        <span>new</span><span>best</span><span>drop</span>
      </div>
    </div>

    <div class="grid">
      <article class="card" *ngFor="let p of products()">
        <div class="media" (click)="openProduct(p)">
          <img [src]="p.images?.[0]" [alt]="p.name" (error)="onImgErr($event)" />
          <div class="thumbs">
            <img *ngFor="let src of p.images" [src]="src" alt="thumb" (error)="onImgErr($event)"/>
          </div>
        </div>

        <div class="info">
          <div>
            <h3>{{ p.name }}</h3>
            <p class="price">{{ p.price | currency:'EUR' }}</p>
          </div>
          <div class="right">
            <span class="tag">{{ p.tag }}</span>
            <button class="add" (click)="cartSvc.add(p)">+ Añadir</button>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- ABOUT -->
  <section *ngIf="tab()==='about'" class="about">
    <h2>Sobre Bye K1tty</h2>
    <p>Diseñador de moda urbana y artista gráfico, especializado en la creación de prendas con mensaje provocador y estética underground. Mi trabajo fusiona el arte, la critica social,
      y la cultura callejera para dar vida a diseños únicos que invitan a la reflexión y la autoexpresión. Colaboro con la comunidad VALODI en el desarrollo de colecciones exclusivas, 
      aportando visión creativa y su compromiso por mantener viva la autenticidad de la moda urbana.
    </p>
  </section>
</main>

<!-- MODAL PRODUCTO -->
<div class="modal-backdrop" *ngIf="selected" (click)="selected=null"></div>
<div class="modal" *ngIf="selected">
  <div class="modal-body" (click)="$event.stopPropagation()">
    <div class="viewer">
      <button class="nav prev" (click)="prev()">‹</button>
      <img [src]="selected!.images[imgIndex]" [alt]="selected!.name" />
      <button class="nav next" (click)="next()">›</button>
    </div>

    <div class="thumbs-lg">
      <button *ngFor="let src of selected!.images; let i = index"
          [class.active]="i===imgIndex"
          (click)="imgIndex=i">
        <img [src]="src" [alt]="'thumb-'+i" />
      </button>
    </div>

    <div class="meta">
      <h3>{{ selected!.name }}</h3>
      <div class="row">
        <span class="price">{{ selected!.price | currency:'EUR' }}</span>
        <button class="cta" (click)="addFromModal()">Añadir al carrito</button>
      </div>
    </div>
  </div>
</div>

<!-- DRAWER CARRITO -->
<div class="drawer" [class.open]="cartOpen">
  <header>
    <h3>Tu carrito</h3>
    <button (click)="cartOpen=false">✕</button>
  </header>

  <div class="content">
    <div class="item" *ngFor="let it of (cartSvc.items$|async)">
      <img [src]="it.img" alt="thumb" />
      <div class="details">
        <p class="name">{{ it.name }}</p>
        <p class="muted">{{ it.price | currency:'EUR' }}</p>
        <div class="qty">
          <button (click)="cartSvc.dec(it.id)">-</button>
          <span>{{ it.qty }}</span>
          <button (click)="cartSvc.inc(it.id)">+</button>
          <button class="muted" (click)="cartSvc.remove(it.id)">Eliminar</button>
        </div>
      </div>
    </div>
    <p class="empty" *ngIf="!(cartSvc.items$|async)?.length">Aún no añadiste productos.</p>
  </div>

  <footer>
    <div class="row">
      <span>Total</span>
      <strong>{{ cartSvc.total() | currency:'EUR' }}</strong>
    </div>
    <div class="row gap">
      <button (click)="cartSvc.clear()">Vaciar</button>
      <button [disabled]="!(cartSvc.items$|async)?.length" class="cta" (click)="checkoutNow()">Checkout</button>
    </div>
  </footer>
</div>
